version: '3.7'

services:
  directus:
    image: directus/directus
    container_name: directus
    ports:
     - 8055:8055
    environment:
      KEY: asdfasdfasdfasdfasdf
      SECRET: asdfasdfasdfasdfsadfafasdfasdfas
      ADMIN_EMAIL: admin@admin.com
      ADMIN_PASSWORD: admin
      PUBLIC_URL: "http://localhost:8055"

  directus-gitsync:
    # image: ghcr.io/beasteers/nodered-git-sync:latest
    image: directus-git-sync
    container_name: directus-git
    restart: unless-stopped
    entrypoint: ['sh', '-c']
    command: 
      - 'while true; do sleep 1000; done'
    build: 
      context: .
    volumes:
      - ~/.ssh/id_rsa:/etc/git-secret/ssh
      - ./data:/git
      - ./directus_git_sync:/src/directus_git_sync
    environment:
      GITSYNC_REPO: git@github.com:floodnet-nyc/floodnet-directus
      GITSYNC_REF: dep-azure-1
      GITSYNC_PERIOD: "30s"
      GITSYNC_SSH: "true"
      LOG_LEVEL: DEBUG
      DIRECTUS_URL: http://directus:8055
      DIRECTUS_EMAIL: admin@admin.com
      DIRECTUS_PASSWORD: admin
      DIRECTUS_OUT_DIR: /git/floodnet-directus
      
